<% cache "#{website.brand_name}_twitter_feed" do %>

<% if website.twitter && tw = website.twitter.match(/(\w*)$/).to_s %>


<div id="twitter_feed_container">
	<% begin %>
	<h2>
		<a href="http://www.twitter.com/intent/user?screen_name=<%= tw %>"><%= image_tag(Twitter.profile_image(tw, :size => 'mini'), :alt => tw) %></a>
		<a href="http://www.twitter.com/intent/user?screen_name=<%= tw %>"><%= Twitter.user(tw).screen_name %></a>
	</h2>
	<div id="tweets">
	<% Twitter.user_timeline(tw).each do |tweet| %>
		<div class="tweet">
			<%=auto_link tweet.text %>
			<p class="tw_actions">
				<a href="http://twitter.com/<%= tw %>/status/<%= tweet.id %>" target="_blank"><%= distance_of_time_in_words(Date.today, tweet.created_at.to_date) %> ago</a>
				&bull; <a href="http://twitter.com/intent/tweet?in_reply_to=<%= tweet.id %>">reply</a>
				&bull; <a href="http://twitter.com/intent/retweet?tweet_id=<%= tweet.id %>">retweet</a>
				&bull; <a href="http://twitter.com/intent/favorite?tweet_id=<%= tweet.id %>">favorite</a>
			</p>
		</div>
    <% end %>
    </div>
	<% rescue %>
	<!-- Twitter API access problem -->
	<% end %>
</div>
<a href="https://twitter.com/<%= tw %>" class="twitter-follow-button" data-show-count="false" data-size="large" data-button="grey" data-text-color="#FFFFFF" data-link-color="#00AEFF">Follow @<%= tw %></a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

<% end %>

<% end %>