<%
  category_names = {
    "gui" => "GUI/Librarians",
    "editor" => "Offline Editors",
    "updater" => "Software Updaters",
    "plugin" => "Plugins",
    "other" => "Other Software",
    "" => "More Downloads"
  }
%>
<% (category_names.keys & product.active_softwares.pluck(:category).uniq).each do |category| %>
  <% if category.present? %>
    <h5><%= category_names[category] %></h5>
  <% else %>
    <h5>More Downloads</h5>
  <% end %>

  <ul class="downloads">
    <% product.active_softwares.each do |software| %>
      <% if software.category == category %>
        <li>
          <%= link_to software do %>
            <% if software.previous_versions.length > 0 %>
              [CURRENT]
            <% end %>
            <%= software.formatted_name %>
          <% end %>
        </li>
        <% software.software_attachments.each do |sa| %>
          <li>
            <%= link_to sa.name, sa.software_attachment.url %>
          </li>
        <% end %>
        <% if software.previous_versions.length > 0 %>
          <li><%= link_to software.previous_versions.first do %>
              [PREVIOUS]
              <%= software.previous_versions.first.formatted_name %>
            <% end %>
          </li>
          <% software.previous_versions.first.software_attachments.each do |sa| %>
            <li>
              <%= link_to sa.name, sa.software_attachment.url %>
            </li>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  </ul>

<% end %>

<ul class="downloads">
  <% product.executable_site_elements.each do |site_element| %>
    <% if can?(:read, site_element) %>
      <li>
        <%= link_to site_element.long_name, site_element.url %>
        <% unless site_element.external_url.present? %>
          [<%= number_to_human_size(site_element.executable_file_size) %>]
        <% end %>
      </li>
    <% end %>
	<% end %>
</ul>
