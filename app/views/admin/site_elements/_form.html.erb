<div class="panel">
<%= s3_uploader_form callback_url: upload_admin_site_elements_url,
    id: "s3_uploader",
    callback_param: "direct_upload_url",
    acl: "public-read",
    expiration: 24.hours.from_now.utc.iso8601,
    max_file_size: 900.megabytes do %>
  <div class="row">
    <div class="large-8 columns">
      <p><%= "#{ @site_element.new_record? ? 'Start' : 'If you want to replace the file, start' } the upload before filling out the rest of the form:" %></p>
      <div class="row">
        <div class="large-6 columns">
          <%= file_field_tag :file %>
        </div>
        <div class="large-6 columns" id="site_element_progress">
          <div id="uploads_container"></div>
          <script id="template-upload" type="text/x-tmpl">
          <div id="upload_{%=o.unique_id%}" class="upload">
            {%=o.name%}
            <div class="progress success progress-striped active"><span class="bar meter" style="width: 0%"></span></div>
            <div id="upload_instruct" class="hint">Wait for the upload to complete before submitting the form.</div>
          </div>
          </script>
        </div>
      </div>

    </div>
  </div>
<% end %>
</div>

<%= simple_form_for [:admin, @site_element] do |f| %>
  <%= f.input :direct_upload_url, as: :hidden %>

  <div class="row">
    <div class="medium-6 small-12 columns">
      <%= f.input :name %>
    </div>
    <div class="medium-6 small-12 columns">
      <%= f.input :external_url, hint: "(Use this instead of the attachment field above for resources hosted on external sites.)" %>
    </div>
  </div>

  <div class="row">
    <div class="medium-6 small-12 columns">
      <%= f.input :language, collection: HarmanSignalProcessingWebsite::Application.config.document_languages %>
    </div>
    <div class="medium-6 small-12 columns">
      <%= f.input :version %>
    </div>
  </div>

  <div class="row">
    <div class="medium-6 columns">
      <%= f.input :resource_type, collection: SiteElement.resource_types %>
      <p><i>"Safety" and "Certification" resource types appear on the
      <%= link_to "/safetyandcertifications", safetyandcertifications_path %> page.</i></p>
    </div>
    <div class="medium-6 columns">
      <br/>
      <%= link_to_function "new resource type", "new_resource_type()", id: "new_resource_type_link" %>
    </div>
  </div>

  <div class="row">
    <div class="medium-6 small-12 columns">
      <label>Broad Categories-select at least one in order to appear on product pages.</label>
      <%= f.input :is_document, label: "This is a document" %>
      <%= f.input :is_software, label: "This is software" %>
      <%= f.input :show_on_public_site, label: "Show on public site in the downloads area" %>
    </div>
  </div>

  <div class="row">
    <div class="large-6 columns">
      <%= f.association :access_level,
        label_method: :long_name,
        hint: "(optional--leave blank to allow all access)" %>
    </div>
  </div>

  <div class="row">
    <div class="small-8 columns">
      <%= f.input :content,
        label: "HTML content--in order for this to work, do not attach a file above or link to an external resource.",
        input_html: { class: "mceEditor", style: "height: 400px" } %>
    </div>
    <div class="small-4 columns">
      <h4>Attachments</h4>
      <div class="panel">
        New for Martin, you can use the Site Resources to create an
        HTML resource. Since you may need to include images, etc. in
        your HTML, this is where you do it.
        <% if @site_element.new_record? %>
          However since this is a new record, you'll have to first
          save this and then return to add images, etc.
        <% else %>
          Right-click and copy the path for the items below to
          include them in your HTML.
        <% end %>
      </div>
      <% unless @site_element.new_record? %>
        <ul>
          <% @site_element.site_element_attachments.each do |att| %>
            <li><%= link_to att.attachment_file_name, att.attachment.url %></li>
          <% end %>
        </ul>
      <% end %>
    </div>
  </div>

  <br/><%= f.button :submit %>

<%= content_for :extra_js do %>
	<script type="text/javascript" charset="utf-8">
		function new_resource_type() {
			$('div.site_element_resource_type').replaceWith('<%= escape_javascript(f.input :resource_type, size: 20) %>');
			$('input#site_element_resource_type').val('');
			$('#new_resource_type_link').replaceWith('<%= escape_javascript(link_to_function "select existing resource type", "existing_resource_type()", id: "existing_type_link") %>');
		}
		function existing_resource_type() {
			$('div.site_element_resource_type').replaceWith('<%= escape_javascript(f.input :resource_type, collection: SiteElement.resource_types) %>');
			$('#existing_type_link').replaceWith('<%= escape_javascript(link_to_function "new resource type", "new_resource_type()", id: "new_resource_type_link") %>');
		}
	</script>
<% end %>

<% end %>
