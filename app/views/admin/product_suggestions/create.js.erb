(function(){
	var 
		$products_dropdown = $('#product_suggestion_suggested_product_id'),
		$list_of_associated_products = $('#product_suggestions');
		
		rebuild_product_list_after_selections_made($products_dropdown);
		build_list_of_products_associated_with_this_product($list_of_associated_products);
		
	function rebuild_product_list_after_selections_made($products_dropdown) {
	
		// clear the product list before we rebuild it
		$products_dropdown.empty();
		
		// rebuild product dropdown list
		$products_dropdown.append($("<option></option>"));
		<% Product.not_associated_with_these_products(@product_suggestion.product.alternatives, website).each do |product| %>
			$products_dropdown.append($("<option value='<%=product.id%>'><%=product.name%></option>"));
		<% end %>
		
		// let chosen know the product dropdown list has been updated
		$products_dropdown.trigger('chosen:updated');	
	
	}  //  function rebuild_product_list($products_dropdown)		
	
	function build_list_of_products_associated_with_this_product($list_of_associated_products) {
		<% @product_suggestions.each do |product_suggestion| %>
			$('#product_suggestions').append('<%= escape_javascript(render "/admin/shared/product_suggestion_row", ps: product_suggestion, called_from: @called_from) %>');
		<% end %>
	}  //  function build_list_of_products_associated_with_this_site_element($list_of_associated_products)	
	
})();

