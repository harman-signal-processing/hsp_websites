# New hardwire site
server {
    listen 10.10.23.88:80;
    listen 10.10.23.87:80;
    server_name www.hardwirepedals.com hardwirepedals.com;
    root /var/www/hmg/hsp_websites/current/public;
    access_log  /var/log/nginx/hardwire-access.log;
    error_log /var/log/nginx/hardwire-error.log;
    passenger_enabled on;
    sendfile on;

    location ~ /\.svn {
      deny all;
    }
    location ~ /\.git {
      deny all;
    }
    location = /favicon.ico {
      alias /var/www/hmg/hsp_websites/current/public/hardwire.ico;
    }
    location ~ ^/(assets)/ {
      root /var/www/hmg/hsp_websites/current/public;
      gzip_static on;
      expires modified +24h;
      add_header Cache-Control public;
      add_header ETag "";
      break;
    }
    location ~ ^/(system)/ {
      root /var/www/hmg/hsp_websites/shared;
      gzip_static on;
      expires modified +24h;
      add_header Cache-Control public;
      add_header ETag "";
      break;
    }
    location ~ ^/(swfs)/ {
      root /var/www/hmg/hsp_websites/current/public;
      gzip_static on;
      expires modified +24h;
      add_header Cache-Control public;
      add_header ETag "";
      break;
    }
    # Get rid of lame iframe params
    if ($args ~ (.*)width=[^&]*(.*)) {
      set $args $1$2;
    }
    if ($args ~ (.*)height=[^&]*(.*)) {
      set $args $1$2;
    }
    if ($args ~ (.*)iframe=[^&]*(.*)) {
      set $args $1$2;
    }
    rewrite ^/\+\+\+\+\+\+.*$ / last;
    rewrite ^/phpMyAdmin.*$ / last;
    rewrite ^/pma\/scripts.*$ / last;
    rewrite ^/MyAdmin.*$ / last;
    rewrite ^/phpmyadmin.*$ / last;
    rewrite ^/myadmin.*$ / last;
    rewrite ^/.*antisec.*$ / last;
    rewrite ^/.*?w00tw00t.*$ / last;

    if ($request_method !~ ^(GET|HEAD|POST|PUT|DELETE|OPTIONS)$) {
      return 405;
    }
    location /mailers/ {
      proxy_set_header X-Forwarded-Host $host;
      proxy_set_header X-Forwarded-Server $host;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 
      proxy_pass http://10.10.69.176;
    }
    location /static/ {
      rewrite ^/static/(.*)$ /static_content/hardwirepedals$1 break;
      proxy_set_header X-Forwarded-Host $host;
      proxy_set_header X-Forwarded-Server $host;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 
      proxy_pass http://10.10.69.176;
    }
    rewrite ^/app$ http://itunes.apple.com/us/app/hardwire-ht-6-fasttune/id492692669?mt=8;
    rewrite ^/index.*$ /en-US permanent;
#    rewrite ^/artist.*$ /en-US/artists permanent;
    rewrite ^/cm\-2.*$ /en-US/products/cm-2 permanent;
    rewrite ^/cm2.*$ /en-US/products/cm-2 permanent;
    rewrite ^/CM2.*$ /en-US/products/cm-2 permanent;
    rewrite ^/cr\-7.*$ /en-US/products/cr-7 permanent;
    rewrite ^/cr7.*$ /en-US/products/cr-7 permanent;
    rewrite ^/CR7.*$ /en-US/products/cr-7 permanent;
    rewrite ^/dl\-8.*$ /en-US/products/dl-8 permanent;
    rewrite ^/dl8.*$ /en-US/products/dl-8 permanent;
    rewrite ^/DL8.*$ /en-US/products/dl-8 permanent;
    rewrite ^/ht\-2.*$ /en-US/products/ht-2 permanent;
    rewrite ^/ht2.*$ /en-US/products/ht-2 permanent;
    rewrite ^/HT2.*$ /en-US/products/ht-2 permanent;
    rewrite ^/ht\-6.*$ /en-US/products/ht-6 permanent;
    rewrite ^/ht6.*$ /en-US/products/ht-6 permanent;
    rewrite ^/HT6.*$ /en-US/products/ht-6 permanent;
    rewrite ^/rv\-7.*$ /en-US/products/rv-7 permanent;
    rewrite ^/rv7.*$ /en-US/products/rv-7 permanent;
    rewrite ^/RV7.*$ /en-US/products/rv-7 permanent;
    rewrite ^/sc\-2.*$ /en-US/products/sc-2 permanent;
    rewrite ^/sc2.*$ /en-US/products/sc-2 permanent;
    rewrite ^/SC2.*$ /en-US/products/sc-2 permanent;
    rewrite ^/sp\-7.*$ /en-US/products/sp-7 permanent;
    rewrite ^/sp7.*$ /en-US/products/sp-7 permanent;
    rewrite ^/SP7.*$ /en-US/products/sp-7 permanent;
    rewrite ^/tl\-2.*$ /en-US/products/tl-2 permanent;
    rewrite ^/tl2.*$ /en-US/products/tl-2 permanent;
    rewrite ^/TL2.*$ /en-US/products/tl-2 permanent;
    rewrite ^/tr\-7.*$ /en-US/products/tr-7 permanent;
    rewrite ^/tr7.*$ /en-US/products/tr-7 permanent;
    rewrite ^/TR7.*$ /en-US/products/tr-7 permanent;
    rewrite ^/contact.*$ /en-US/support permanent;
    rewrite ^/Support.*$ /en-US/support permanent;
    rewrite ^/support.*$ /en-US/support permanent;
    rewrite ^/constant.*$ /en-US/hardwire_innovation permanent;
    rewrite ^/high\-voltage.*$ /en-US/hardwire_innovation permanent;
    rewrite ^/meticulous.*$ /en-US/hardwire_innovation permanent;
    rewrite ^/technology.*$ /en-US/hardwire_innovation permanent;
    rewrite ^/true.*$ /en-US/hardwire_innovation permanent;
    rewrite ^/warranty.*$ /en-US/support/warranty_registration permanent;
    rewrite ^/training.*$ /en-US/hardwire_training permanent;
    rewrite ^/rohs.*$ /en-US/rohs permanent;
    rewrite ^/gear\-registration.*$ /en-US/support/warrant_registration permanent;
    rewrite ^/current\-promotions.*$ /en-US/promotions permanent;
    rewrite ^/dealer.*$ /en-US/where_to_buy permanent;
    rewrite ^/international.*$ /en-US/international_distributors permanent;
    rewrite ^/where\-to\-buy.*$ /en-US/where_to_buy permanent;
    rewrite ^/hardwire\-story.*$ /en-US/hardwire_story permanent;
    rewrite ^/privacy.*$ /en-US/hardwire_privacy_policy permanent;
    rewrite ^/product\-reviews.*$ /en-US/product_reviews permanent;
    rewrite ^/sitemap.*$ /en-US/sitemap.xml permanent;
    rewrite ^/whats\-new.*$ /en-US/news permanent;
}

