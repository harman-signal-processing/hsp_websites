# Martin forwarder
server {
  listen 80;
  server_name martin.com;
  return 301 $scheme://www.martin.com$request_uri;
}

# New martin site
server {
  listen 80;
  server_name martin.hprosandbox.com;
  server_name www.martin.com;
  include "/etc/nginx/security.conf";
  root /var/www/brandsites/current/public;
  access_log  /var/log/nginx/martin-access.log;
  error_log /var/log/nginx/martin-error.log;
  sendfile on;

  location = /favicon.ico {
    alias /var/www/brandsites/current/public/martin.ico;
  }
  location = /logo.png {
    proxy_pass http://d92e2d4def4ad9ded9c8-e33f4b22204b900070d3db62d0c33a2c.r80.cf2.rackcdn.com/martin.png;
  }

  ################################################
  # When going live, get rid of this block and replace it with:
  # include "/etc/nginx/common.conf";
  #
  # Common to most all the rails sites
  add_header X-Frame-Options "SAMEORIGIN";
  passenger_enabled on;
  passenger_friendly_error_pages off;
  proxy_cache hsp;

  location / {
    if (-f /var/www/brandsites/shared/config/maintenance.txt) {
        return 503;
    }
    if ($request_uri ~* ".(jpg|jpeg|gif|gz|flv|wmv|avi|css|swf|png|ico|mpeg|mpg|mp3|mp4|js)(\?v=[0-9.]+)?$") {
      expires 7d;
      access_log off;
      break;
    }
    passenger_enabled on;
    passenger_friendly_error_pages off;
  }
  location ~ ^/(assets)/ {
    root /var/www/brandsites/current/public;
    gzip_static on;
    gzip_http_version 1.0;
    expires      365d;
    add_header Cache-Control public;
    add_header   Last-Modified "";
    add_header ETag "";
    break;
  }
  location ~ ^/(system)/ {
    root /var/www/brandsites/shared;
    gzip_static on;
    gzip_http_version 1.0;
    expires      30d;
    add_header Cache-Control public;
    add_header   Last-Modified "";
    add_header ETag "";
    break;
  }

  # cn redirect to zh
  location /cn {
    rewrite ^ /zh permanent;
  }
  error_page 503 @maintenance;
  location @maintenance {
     rewrite ^(.*)$ /503.html break;
  }
  # END the block to get rid of when going live.
  ####################################################

  #
  # Add redirects below
  #
  # An example using a regexp rewrite:
  #rewrite ^/fxpedals\/fx102.*$ /en-US/products/fx102 permanent;
  #
  # An example using a "return" which is supposed to be more efficient than rewrites:
  #location ~* ^/huddle-space/? { return 301 $scheme://$http_host/en-US/product_families/amx-collaboration-systems; }
  #
  # An example using http params like ?id=something
  #location ^~ /product.php {
	#  if ($args ~ id=166) { rewrite ^ /en-US/products/omega? permanent; }
	#}
	#
	#

  # Redirects all the old product page links to the new ones. This assumes the
  # "friendly_id" on the old system matches the new system. In spot-checking, it
  # seems that they are. In cases where they aren't identical, create a redirect
  # rule case-by-case above this one:
  # TODO: some of the old URLs have parenthesis in them. We need to strip those out
  # for the new URL.
  location ~* ^/en-us\/product-details\/(.*) {
    return 301 $scheme://$http_host/en-US/products/$1;
  }
  location ~* ^/en-us\/support\/product-details\/(.*) {
    return 301 $scheme://$http_host/en-US/products/$1#documentation;
  }


  location ~* ^/product\/product.asp {
   	if ($args ~ product=RUSHPAR2RGBWZoom) { rewrite ^	/en-US/products/rush-par-1-rgbw permanent; }
   	if ($args ~ product=rushpar1rgbw) { rewrite ^	/en-US/products/rush-par-2-rgbw-zoom permanent; }
   	if ($args ~ product=RUSHMultibeam2) { rewrite ^	/en-US/products/rush-multibeam-2 permanent; }
   	if ($args ~ product=RUSHMH5Profile) { rewrite ^	/en-US/products/rush-mh-5-profile permanent; }
   	if ($args ~ product=rushmh4beam) { rewrite ^	/en-US/products/rush-mh-4-beam permanent; }
   	if ($args ~ product=rushmh3beam) { rewrite ^	/en-US/products/rush-mh-3-beam permanent; }
   	if ($args ~ product=macviperwashdx) { rewrite ^	/en-US/products/mac-viper-wash-dx permanent; }
   	if ($args ~ product=macviperwash) { rewrite ^	/en-US/products/mac-viper-wash permanent; }
   	if ($args ~ product=macviperperformance) { rewrite ^	/en-US/products/mac-viper-performance permanent; }
   	if ($args ~ product=MACViperBeam) { rewrite ^	/en-US/products/mac-viper-beam permanent; }
   	if ($args ~ product=macviperairfx) { rewrite ^	/en-US/products/mac-viper-airfx permanent; }
   	if ($args ~ product=MACQuantumWash) { rewrite ^	/en-US/products/mac-quantum-wash permanent; }
   	if ($args ~ product=MACQuantumProfile) { rewrite ^	/en-US/products/mac-quantum-profile permanent; }
   	if ($args ~ product=atomiccolors) { rewrite ^	/en-US/product_families permanent; }
  }

  location ~* ^/general\/news\.asp { return 301 $scheme://$http_host/en-US/news; }
  location ~* ^/ipr { return 301 $scheme://$http_host/martin-legal; }
  location ~* ^/legal { return 301 $scheme://$http_host/martin-legal; }
  location ~* ^/general\/legal.asp { return 301 $scheme://$http_host/martin-legal; }
  location ~* ^/mails\/TermsAndConditions { return 301 $scheme://$http_host/en-US/terms_of_use.html; }

  location ~* ^/demo { return 301 https://podio.com/webforms/12488098/853814; }
  location ~* ^/controllersupport\/m-pc_software.html { return 301 http://controllersupport.martin.com/Content/Home.htm; }
  location ~* ^/controllersupport\/support.asp { return 301 http://controllersupport.martin.com/Content/Home.htm; }
  location ~* ^/controllersupport\/fixture_libraries.html	{ return 301 http://controllersupport.martin.com/Content/Home.htm; }
  location ~* ^/controllersupport/ { return 301 http://controllersupport.martin.com/Content/Home.htm; }
  location ~* ^/weresexyandweknowit { return 301 http://vimeo.com/117373056; }
  location ~* ^/VDO { return 301 $scheme://$http_host/en-US/product_families/stage; }

  # this one changes often:
  location ~* ^/ustour { return 301 $scheme://$http_host/en-US/events/mac-encore-u-s-demo-tour-winter-2018; }

  location ~* ^/rushcs { return 301 $scheme://$http_host/en-US/products/rush-cs-series; }
  location ~* ^/qr\/92215360 { return 301 $scheme://$http_host/en-US/products/jem-zr45; }
  location ~* ^/qr\/92215340 { return 301 $scheme://$http_host/en-US/products/jem-zr35; }
  location ~* ^/qr\/92215320 { return 301 $scheme://$http_host/en-US/products/jem-zr25; }
  location ~* ^/qr\/90737090 { return 301 $scheme://$http_host/en-US/products/m1-hd; }
  location ~* ^/qr\/90737080 { return 301 $scheme://$http_host/en-US/products/m2go-hd; }
  location ~* ^/qr\/90234040 { return 301 $scheme://$http_host/en-US/products/mac-encore-wash-cld; }
  location ~* ^/qr\/90234025 { return 301 $scheme://$http_host/en-US/products/mac-encore-wash-wrm; }
  location ~* ^/qr\/90234016 { return 301 $scheme://$http_host/en-US/products/mac-encore-performance-wrm ; }
  location ~* ^/qr\/90234015 { return 301 $scheme://$http_host/en-US/products/mac-encore-performance-wrm ; }
  location ~* ^/qr\/90234005 { return 301 $scheme://$http_host/en-US/products/mac-encore-performance-cld ; }
  location ~* ^/qr\/90234000 { return 301 $scheme://$http_host/en-US/products/mac-encore-performance-cld ; }

  location ~* ^/M-Touch	{ return 301 $scheme://$http_host/en-US/products/m-touch; }
  location ~* ^/MSeries	{ return 301 $scheme://$http_host/en-US/product_families/lighting-controllers; }
  location ~* ^/mh11 { return 301 $scheme://$http_host/en-US/products/rush-mh-11-beam; }
  location ~* ^/mh10 { return 301 $scheme://$http_host/en-US/products/rush-mh-10-beam-fx; }
  location ~* ^/macviperAirfx { return 301 $scheme://$http_host/en-US/products/mac-viper-airfx; }
  location ~* ^/face5 { return 301 $scheme://$http_host/en-US/product_families/stage; }
  location ~* ^/en-US\/Product-Details\/M-PC-V3 { return 301 $scheme://$http_host/en-US/products/m-pc; }
  location ~* ^/en-US\/Product-Details\/iOS-MAXRemote { return 301 $scheme://$http_host/en-US/products/ios-m-series-remote; }
  location ~* ^/email_signature\/uk_smoke { return 301 $scheme://$http_host/en-US/products/jem-hazer-pro; }
  location ~* ^/controllers { return 301 $scheme://$http_host/en-US/product_families/lighting-controllers; }

  #TODO: create fixture request page
  #location ~* ^/product/fixturerequest.asp	Fixture Req LP

  #TODO: create this page
  #location ~* ^/Inspiration

}
