# This server block will be replaced by the one that follows it
# which is under development.
server {
    listen 10.10.23.52:80;
    server_name www.bssaudio.com 10.10.23.52 "" -;
    root /var/www/hmg/bss;
    passenger_enabled off;
    access_log  /var/log/nginx/bss-access.log;
    error_log /var/log/nginx/bss-error.log;
    client_max_body_size 300M; 
    client_body_buffer_size 128k;

    # Anything that doesn't start with /training
    # should be proxied to the windows server
    location = /favicon.ico {
      alias /var/www/hmg/hsp_websites/current/public/bss.ico;
    }
    location = /training.php {
       proxy_pass http://10.10.69.172;
    }
    location = /training_test.php {
       proxy_pass http://10.10.69.172;
    }
    location = /trainingmodules.php {
       proxy_pass http://10.10.69.172;
    }
    location ^~ /TrainingModules {
       proxy_pass http://10.10.69.172;
    }
    location ^~ /training {
       passenger_enabled on;
       passenger_base_uri /training;
       break;
    }
    location / {
      proxy_pass http://10.10.69.172;
    }
    location ~ /\.svn {
      deny all;
    }
    location ~ /\.git {
      deny all;
    }
    sendfile on;
#    passenger_set_cgi_param HTTP_X_ACCEL_MAPPING /var/www/hmg/hsp_websites/shared/system/=/system/;
#    passenger_pass_header X-Accel-Redirect;
#    location /system {
#      root /var/www/hmg/hsp_websites/shared;
#      internal;
#    }
    if ($request_method !~ ^(GET|HEAD|POST|PUT|DELETE|OPTIONS)$) {
      return 405;
    }
}

server {
    listen 10.10.23.88:80;
    server_name bsstest.digitech.com bssaudio.com bssaudious.com www.bss.co.uk www.bssaudio.com www.bssaudious.com;
    root /var/www/hmg/hsp_websites/current/public;
    access_log  /var/log/nginx/bss-access.log;
    error_log /var/log/nginx/bss-error.log;
    client_max_body_size 300M; 
    client_body_buffer_size 128k;

    location / {
      auth_basic  "Restricted";
      auth_basic_user_file /var/www/hmg/marketingqueue/htpasswd;
      passenger_enabled on;
      sendfile on;
#      passenger_set_cgi_param HTTP_X_ACCEL_MAPPING /var/www/hmg/hsp_websites/shared/system/=/system/;
#      passenger_pass_header X-Accel-Redirect;
    }
#    location /system {
#      root /var/www/hmg/hsp_websites/shared;
#      internal;
#    }
    location ~ ^/(assets)/ {
      root /var/www/hmg/hsp_websites/current/public;
      gzip_static on;
      expires modified +24h;
      add_header Cache-Control public;
      add_header ETag "";
      break;
    }
    location ~ ^/(system)/ {
      root /var/www/hmg/hsp_websites/shared;
      gzip_static on;
      expires modified +24h;
      add_header Cache-Control public;
      add_header ETag "";
      break;
    }
    location ~ ^/(swfs)/ {
      root /var/www/hmg/hsp_websites/current/public;
      gzip_static on;
      expires modified +24h;
      add_header Cache-Control public;
      add_header ETag "";
      break;
    }
    # Get rid of lame iframe params
    if ($args ~ (.*)width=[^&]*(.*)) {
      set $args $1$2;
    }
    if ($args ~ (.*)height=[^&]*(.*)) {
      set $args $1$2;
    }
    if ($args ~ (.*)iframe=[^&]*(.*)) {
      set $args $1$2;
    }

    location = /favicon.ico {
      alias /var/www/hmg/hsp_websites/current/public/bss.ico;
    }
    location = /training.php {
       proxy_pass http://10.10.69.172;
    }
    location = /training_test.php {
       proxy_pass http://10.10.69.172;
    }
    location = /trainingmodules.php {
       proxy_pass http://10.10.69.172;
    }
    location ^~ /TrainingModules {
       proxy_pass http://10.10.69.172;
    }
    location ^~ /training {
       passenger_enabled on;
       passenger_base_uri /training;
       break;
    }
    location /mailers/ {
      proxy_pass http://10.10.69.172;
    }
    location /static/ {
      proxy_pass http://10.10.69.172;
    }
    location /phpBB2/ {
      proxy_pass http://10.10.69.172;
    }
    location /product_downloads/ {
      proxy_pass http://10.10.69.172;
    }
    location /Toolkit/ {
      proxy_pass http://10.10.69.172;
    }
    location /toolkit/ {
      proxy_pass http://10.10.69.172;
    }
    rewrite ^/conferencing\.php.*$ /en-US/bss-conferencing permanent;
    rewrite ^/News.*$ /en-US/news permanent;
    rewrite ^/news.*$ /en-US/news permanent;

    # Product Families
    rewrite ^/products\.php.*$ /en-US/product_families permanent;
    rewrite ^/ethernet_avb_products.*$ /en-US/product_families/ethernet-avb permanent;
    rewrite ^/soundweb_london.*$ /en-US/product_families/soundweb-london permanent;
    rewrite ^/accessory.*$ /en-US/product_families/accessory-products permanent;
    rewrite ^/discont_products.*$ /en-US/support permanent;
    rewrite ^/equalizers.*$ /en-US/product_families/equalizers--3 permanent;
    rewrite ^/crossovers_loudspeaker.*$ /en-US/product_families/electronic-crossovers-loudspeaker-management permanent;
    rewrite ^/digital_processors\.php.*$ /en-US/support permanent;
    rewrite ^/soundweb\.php.*$ /en-US/support permanent;
    rewrite ^/dynamic_processors\.php.*$ /en-US/support permanent;
    rewrite ^/signal_distribution\.php.*$ /en-US/support permanent;

    # Products
    rewrite ^/productpg\.php\?product_id\=72$ /en-US/products/gs724t   permanent;
    rewrite ^/productpg\.php\?product_id\=76$ /en-US/products/blu-805  permanent;
    rewrite ^/productpg\.php\?product_id\=49$ /en-US/products/blu-800  permanent;
    rewrite ^/productpg\.php\?product_id\=43$ /en-US/products/blu-80   permanent;
    rewrite ^/productpg\.php\?product_id\=77$ /en-US/products/blu-325  permanent;
    rewrite ^/productpg\.php\?product_id\=50$ /en-US/products/blu-320  permanent;
    rewrite ^/productpg\.php\?product_id\=41$ /en-US/products/blu-32   permanent;
    rewrite ^/productpg\.php\?product_id\=51$ /en-US/products/blu-160  permanent;
    rewrite ^/productpg\.php\?product_id\=39$ /en-US/products/blu-16   permanent;
    rewrite ^/productpg\.php\?product_id\=52$ /en-US/products/blu-120  permanent;
    rewrite ^/productpg\.php\?product_id\=65$ /en-US/products/blu-100  permanent;
    rewrite ^/productpg\.php\?product_id\=70$ /en-US/products/blu-101  permanent;
    rewrite ^/productpg\.php\?product_id\=71$ /en-US/products/blu-102  permanent;
    rewrite ^/productpg\.php\?product_id\=67$ /en-US/products/blu-bib  permanent;
    rewrite ^/productpg\.php\?product_id\=61$ /en-US/products/blu-bob1 permanent;
    rewrite ^/productpg\.php\?product_id\=60$ /en-US/products/blu-bob2 permanent;
    rewrite ^/productpg\.php\?product_id\=56$ /en-US/products/blu-10wht  permanent;
    rewrite ^/productpg\.php\?product_id\=55$ /en-US/products/blu-10blk  permanent;
    rewrite ^/productpg\.php\?product_id\=38$ /en-US/products/blu-10blu  permanent;
    rewrite ^/productpg\.php\?product_id\=74$ /en-US/products/blu-8v2wht permanent;
    rewrite ^/productpg\.php\?product_id\=73$ /en-US/products/blu-8v2blk permanent;
    rewrite ^/productpg\.php\?product_id\=40$ /en-US/products/blu-3    permanent;
    rewrite ^/productpg\.php\?product_id\=42$ /en-US/products/blu-6    permanent;
    rewrite ^/productpg\.php\?product_id\=57$ /en-US/products/9012us   permanent;
    rewrite ^/productpg\.php\?product_id\=58$ /en-US/products/9015us   permanent;
    rewrite ^/productpg\.php\?product_id\=68$ /en-US/products/blu-hif  permanent;
    rewrite ^/productpg\.php\?product_id\=59$ /en-US/products/mc-1     permanent;
    rewrite ^/productpg\.php\?product_id\=69$ /en-US/products/1u-rack-mount-kit permanent;
    rewrite ^/productpg\.php\?product_id\=17$ /en-US/products/ar-133  permanent;
    rewrite ^/productpg\.php\?product_id\=75$ /en-US/products/usb-to-serial-cable permanent;
    rewrite ^/productpg\.php\?product_id\=2$  /en-US/products/fcs-966  permanent;
    rewrite ^/productpg\.php\?product_id\=1$  /en-US/products/fcs-960  permanent;
    rewrite ^/productpg\.php\?product_id\=6$  /en-US/products/fds-366t permanent;
    rewrite ^/productpg\.php\?product_id\=4$  /en-US/products/fds-334t336t permanent;

    # Discontinued products
    rewrite ^/discont_productpg\.php\?product_id\=19$ /en-US/products/sw9026  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=20$ /en-US/products/sw9016  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=21$ /en-US/products/sw9012  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=22$ /en-US/products/sw9015  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=23$ /en-US/products/sw9014  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=24$ /en-US/products/sw3088  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=25$ /en-US/products/sw9008iis permanent;
    rewrite ^/discont_productpg\.php\?product_id\=28$ /en-US/products/sw9000iis permanent;
    rewrite ^/discont_productpg\.php\?product_id\=29$ /en-US/products/sw9010  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=31$ /en-US/products/sw9088iis permanent;
    rewrite ^/discont_productpg\.php\?product_id\=16$ /en-US/products/ar-416  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=18$ /en-US/products/ar-204  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=45$ /en-US/products/ar-130  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=46$ /en-US/products/ar-125  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=9$  /en-US/products/opal-series-dpr-944 permanent;
    rewrite ^/discont_productpg\.php\?product_id\=10$ /en-US/products/dpr-901ii permanent;
    rewrite ^/discont_productpg\.php\?product_id\=11$ /en-US/products/dpr-504   permanent;
    rewrite ^/discont_productpg\.php\?product_id\=12$ /en-US/products/opal-series-dpr-522 permanent;
    rewrite ^/discont_productpg\.php\?product_id\=13$ /en-US/products/dpr-402  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=14$ /en-US/products/dpr-404  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=15$ /en-US/products/opal-series-dpr-422  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=37$ /en-US/products/fcs-926  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=3$  /en-US/products/fds-310  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=5$  /en-US/products/fds-360  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=27$ /en-US/products/fds-318  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=32$ /en-US/products/fds-355-omnidrive permanent;
    rewrite ^/discont_productpg\.php\?product_id\=33$ /en-US/products/fds-388-omnidrive permanent;
    rewrite ^/discont_productpg\.php\?product_id\=34$ /en-US/products/fds-380-omnidrive permanent;
    rewrite ^/discont_productpg\.php\?product_id\=8$  /en-US/products/prosys-ps-8810  permanent;
    rewrite ^/discont_productpg\.php\?product_id\=26$ /en-US/products/msr-602604ii permanent;

# Yet to do...
# /software_applications.php
# /discont_productpg.php?product_id=7 (SB2 Control Software)
# /discont_productpg.php?product_id=35 (Soundbench PC Control Software)
# http://www.bssaudio.com/aboutsoundweblondon.php
# http://www.bssaudio.com/aboutsoundweb.php
# http://www.bssaudio.com/Firmware_Wizard/index.php
# http://www.bssaudio.com/contact_parts.php
# http://www.bssaudio.com/contact_support.php
# http://www.bssaudio.com/contact_repairs.php
}