# Common to most all the rails sites

# Keeps everyone out of the marketing queue files
location ~ ^/system\/marketing_attachments/ {
  internal;
}

location ~ ^/(assets)/ {
  root /var/www/hmg/hsp_websites/current/public;
  gzip_static on;
  gzip_http_version 1.0;
  expires      365d;
  add_header Cache-Control public;
  add_header   Last-Modified "";
  add_header ETag "";
  break;
}
location ~ ^/system\/wares/ {
  internal;
  root /var/www/hmg/hsp_websites/shared;
  gzip_static on;
  gzip_http_version 1.0;
  expires      365d;
  add_header Cache-Control public;
  add_header   Last-Modified "";
  add_header ETag "";
  break;
}
location ~ ^/(system)/ {
  root /var/www/hmg/hsp_websites/shared;
  gzip_static on;
  gzip_http_version 1.0;
  expires      30d;
  add_header Cache-Control public;
  add_header   Last-Modified "";
  add_header ETag "";
  break;
}
location ~ ^/(swfs)/ {
  root /var/www/hmg/hsp_websites/current/public;
  gzip_static on;
  gzip_http_version 1.0;
  expires      365d;
  add_header Cache-Control public;
  add_header   Last-Modified "";
  add_header ETag "";
  break;
}

# cn redirect to zh
location /cn {
  rewrite ^ /zh permanent;
}

# Get rid of lame iframe params
if ($args ~ (.*)width=[^&]*(.*)) {
  set $args $1$2;
}
if ($args ~ (.*)height=[^&]*(.*)) {
  set $args $1$2;
}
if ($args ~ (.*)iframe=[^&]*(.*)) {
  set $args $1$2;
}
